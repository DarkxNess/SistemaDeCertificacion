@model Aplicacion_web_de_certificacion.Models.PedidoEnsayo

@{
    ViewData["Title"] = "EditarPedidoEnsayo";

    String mensaje = "";

    if (Model.PresupuestoLista[0].StatusPresupuesto == 1)
    {
        mensaje = "Presupuesto";
    }

    if (Model.PresupuestoLista[0].StatusPresupuesto == 2)
    {
        mensaje = "Pedido de Ensayos";
    }

    if (Model.PresupuestoLista[0].StatusPresupuesto == 3)
    {
        mensaje = "Aprobación Solicitud";
    }

    if (Model.PresupuestoLista[0].StatusPresupuesto == 4)
    {
        mensaje = "Aprobación Evaluación";
    }

    if (Model.PresupuestoLista[0].StatusPresupuesto == 5)
    {
        mensaje = "Aprobación Revisión y Decisión";
    }

    if (Model.PresupuestoLista[0].StatusPresupuesto == 6)
    {
        mensaje = "Finalizado";
    }

    if (Model.PresupuestoLista[0].StatusPresupuesto == 7)
    {
        mensaje = "Cancelado";
    }
}

<div class="panel panel-primary" style="">
    <!--box header-->
    <div class="panel-heading">
        <table align="center"><tr><td><h3>Pedido de Ensayo Nº @Model.IdPedidoEnsayo </h3></td></tr></table>
    </div><!--/box header-->
    @if (Model.PresupuestoLista[0].StatusPresupuesto < 3)
    {
        <table align="center"><tr><td><button type="button" class="btn btn-warning"> Status @Model.PresupuestoLista[0].StatusPresupuesto @mensaje </button></td></tr></table>}

    @if (Model.PresupuestoLista[0].StatusPresupuesto == 3)
    {
        <table align="center">
            <tr>
                <td>
                    <form asp-controller="Ensayos" asp-action="EditarEnsayoDesdePedido" class="form-horizontal">
                        <input asp-for="IdPedidoEnsayo" class="form-control" contenteditable="false" type="hidden" />

                        <button type="submit" class="btn btn-warning">Status @Model.PresupuestoLista[0].StatusPresupuesto @mensaje En Ensayos </button>
                    </form>
                </td>
            </tr>
        </table>
    }


        @if (Model.PresupuestoLista[0].StatusPresupuesto >= 3)
        {
        <table align="center">

            <tr>
                <td>
                    <form asp-controller="Ensayos" asp-action="EditarEnsayoDesdePedido" class="form-horizontal">
                        <input asp-for="IdPedidoEnsayo" class="form-control" contenteditable="false" type="hidden" />

                        <button type="submit" class="btn btn-warning">Status @Model.PresupuestoLista[0].StatusPresupuesto @mensaje  </button>
                    </form>
                </td>
            </tr>
            <tr>
                <td>
                    @if (Model.PresupuestoLista[0].StatusPresupuesto == 2 && Model.EnsayosLista.Count == 0)
                    {

                        <form asp-controller="Ensayos" asp-action="GenerarEnsayo" class="form-horizontal">
                            <input asp-for="IdPedidoEnsayo" class="form-control" contenteditable="false" type="hidden" />
                            <input asp-for="presupuestos_IdPresupuestos" class="form-control" contenteditable="false" type="hidden" />
                            <button id="GenerarEnsayo" type="submit" class="btn btn-warning">
                                Generar Ensayo
                            </button>
                        </form>
                    }
                </td>
            </tr>
        </table>
        }
        <table align="center">
            <tr>
                <td align="center">
                    @if (Model.StatusPedidoEnsayo != 7)
                    {
                        <form asp-action="CancelarProducto" class="form-horizontal">
                            <input asp-for="IdPedidoEnsayo" class="form-control" contenteditable="false" type="hidden" />

                            <input type="submit" value="Cancelar" class="btn btn-primary" />

                        </form>
                    }
                    </td>
            </tr>
            <tr>
                <td align="center">
                    @if (Model.PresupuestoLista[0].StatusPresupuesto == 2 && Model.EnsayosLista.Count == 0)
                    {

                        <form asp-controller="Ensayos" asp-action="GenerarEnsayo" class="form-horizontal">
                            <input asp-for="IdPedidoEnsayo" class="form-control" contenteditable="false" type="hidden" />
                            <input asp-for="presupuestos_IdPresupuestos" class="form-control" contenteditable="false" type="hidden" />
                            <button id="GenerarEnsayo" type="submit" class="btn btn-warning">
                                Generar Ensayo
                            </button>
                        </form>
                    }
                </td>
            </tr>
        </table>
        <div class="pull-right">



            @if (Model.EnsayosLista != null && Model.EnsayosLista.Count > 0)
            {
                @if (Model.PresupuestoLista[0].StatusPresupuesto == 6 && Model.EnsayosLista[0].StatusEnsayo == "Aprobado")
                {
                    @if (User.IsInRole("JefeOCP") || User.IsInRole("Admin"))
                    {

                        <form asp-controller="PedidoEnsayo" asp-action="EmitirCertificado" class="form-horizontal">
                            <input asp-for="IdPedidoEnsayo" class="form-control" contenteditable="false" type="hidden" />
                            <input asp-for="presupuestos_IdPresupuestos" class="form-control" contenteditable="false" type="hidden" />
                            <button id="GenerarEnsayo" type="submit" class="btn btn-warning">
                                Generar Certificado
                            </button>
                        </form>
                    }
                }
            }


            @if (Model.EnsayosLista != null && Model.EnsayosLista.Count > 0)
            {
                @if (Model.EnsayosLista[0].StatusEnsayo == "Rechazado")
                {
                    @if (User.IsInRole("JefeOCP") || User.IsInRole("Admin"))
                    {

                        <form asp-controller="PedidoEnsayo" asp-action="EmitirCertificadoRechazo" class="form-horizontal">
                            <input asp-for="IdPedidoEnsayo" class="form-control" contenteditable="false" type="hidden" />
                            <input asp-for="presupuestos_IdPresupuestos" class="form-control" contenteditable="false" type="hidden" />
                            <button id="GenerarEnsayo" type="submit" class="btn btn-warning">
                                Generar Certificado de Rechazo
                            </button>
                        </form>
                    }
                }
            }


        </div>
        <div class="row-fluid">
            <div class="span12">
                <div class="row">
                    <div class="box corner-all">
                        <!--box body-->
                        <div class="panel-body">
                            <div class="row-fluid">
                                <!--element-->

                                <form asp-action="GuardarPedidoEnsayo" method="post">

                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="row-fluid">
                                                <div class="col-md-6">

                                                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                                    <div class="editor-label">
                                                        <label asp-for="ProtocoloAplicable" class="control-label">Protocolo Aplicable</label>
                                                    </div>
                                                    <div class="editor-field">
                                                        <input asp-for="ProtocoloAplicable" class="form-control" />
                                                        <span asp-validation-for="ProtocoloAplicable" class="text-danger"></span>
                                                    </div>
                                                    <div class="editor-label">
                                                        <label asp-for="CondicionesDeEnsayo" class="control-label">Consideraciones de Ensayo</label>
                                                    </div>
                                                    <div class="editor-field">
                                                        <input asp-for="CondicionesDeEnsayo" class="form-control" />
                                                        <span asp-validation-for="CondicionesDeEnsayo" class="text-danger"></span>
                                                    </div>
                                                    <div class="editor-label">
                                                        <label asp-for="Comentarios" class="control-label">Comentarios</label>
                                                    </div>
                                                    <div class="editor-field">
                                                        <input asp-for="Comentarios" class="form-control" />
                                                        <span asp-validation-for="Comentarios" class="text-danger"></span>
                                                    </div>

                                                </div>

                                                <div class="col-md-6">

                                                    <div class="editor-label">
                                                        <label asp-for="AutorPedido" class="control-label">Autor Pedido</label>
                                                    </div>
                                                    <div class="editor-field">
                                                        <input asp-for="AutorPedido" class="form-control" disabled="disabled" onKeyPress="javascript: return false;" onPaste="javascript: return false;" contenteditable="false" />
                                                        <span asp-validation-for="AutorPedido" class="text-danger"></span>
                                                    </div>

                                                    <div class="editor-label">
                                                        <label asp-for="NumeroSec" class="control-label">Número SEC</label>
                                                    </div>
                                                    <div class="editor-field">
                                                        <input asp-for="NumeroSec" class="form-control" />
                                                        <span asp-validation-for="NumeroSec" class="text-danger"></span>
                                                    </div>

                                                </div>


                                            </div>
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row">
                                        <div class="col-md-12">

                                            <div class="row-fluid">
                                                <div class="col-md-12">
                                                    <div class="pull-right">
                                                        <input asp-for="presupuestos_IdPresupuestos" type="hidden" class="form-control" />
                                                        <input asp-for="IdPedidoEnsayo" type="hidden" class="form-control" />
                                                        <a asp-action="Index" class="btn btn-primary">Volver a la lista</a>
                                                        <input type="submit" value="Guardar" class="btn btn-primary" />
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                </form>

                                <br />
                                <div class="row-fluid">
                                    <div class="">
                                        <fieldset>
                                            <legend>Muestras</legend>

                                            <div id="grid-contacto">
                                                <div class="row-fluid">
                                                    <!--element-->
                                                    <div class="row">
                                                        <div class="col-md-12">

                                                            <div class="row-fluid">
                                                                <div class="col-md-12">
                                                                    <button type="button" id="btnCrearMuestra" class="btn btn-warning" data-toggle="modal" data-target="#CrearNuevaMuestra" data-id="@Model.IdPedidoEnsayo">Añadir Ítem</button>

                                                                    <table class="table table-responsive table-striped table-bordered">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Editar</th>
                                                                                <th>
                                                                                    Nombre Producto
                                                                                </th>

                                                                                <th>
                                                                                    Fecha Ingreso
                                                                                </th>
                                                                                <th>
                                                                                    Etiqueta
                                                                                </th>
                                                                                <th>
                                                                                    Cantidad
                                                                                </th>
                                                                                <th>
                                                                                    Marca
                                                                                </th>
                                                                                <th>
                                                                                    Modelo
                                                                                </th>
                                                                                <th>
                                                                                    Fabricante
                                                                                </th>
                                                                                <th>
                                                                                    País de origen
                                                                                </th>
                                                                                <th>
                                                                                    Destino
                                                                                </th>

                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            @{ if (Model.MuestrasLista != null)
                                                                                {
                                                                                    @foreach (var item in Model.MuestrasLista)
                                                                                    {
                                                                                        <tr>
                                                                                            <td class="success">


                                                                                                <button type="button" id="btnEditarMuestra" class="btn btn-info btn-lg" data-toggle="modal" data-target="#ModificarMuestraModal" data-id="@item.IdMuestras">Editar</button>


                                                                                            </td>

                                                                                            <td class="active">
                                                                                                @Html.DisplayFor(modelItem => item.Producto)
                                                                                            </td>

                                                                                            <td class="">
                                                                                                @Html.DisplayFor(modelItem => item.FechaIngreso2)
                                                                                            </td>

                                                                                            <td class="active">
                                                                                                @Html.DisplayFor(modelItem => item.Etiqueta)
                                                                                            </td>

                                                                                            <td class="">
                                                                                                @Html.DisplayFor(modelItem => item.Cantidad)
                                                                                            </td>

                                                                                            <td class="active">
                                                                                                @Html.DisplayFor(modelItem => item.Marca)
                                                                                            </td>

                                                                                            <td class="">
                                                                                                @Html.DisplayFor(modelItem => item.Modelo)
                                                                                            </td>

                                                                                            <td class="active">
                                                                                                @Html.DisplayFor(modelItem => item.Fabricante)
                                                                                            </td>

                                                                                            <td class="active">
                                                                                                @Html.DisplayFor(modelItem => item.PaisOrigen)
                                                                                            </td>

                                                                                            <td class="active">
                                                                                                @Html.DisplayFor(modelItem => item.DestinoMuestras)
                                                                                            </td>
                                                                                        </tr>
                                                                                    }
                                                                                }
                                                                            }
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>

                                @if (Model.CotizacionesLista != null)
                                {
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="row-fluid">
                                                <div class="col-md-12">
                                                    <div class="tab-pane fade active in">
                                                        <table class="table table-bordered table-condensed invoice">
                                                            <thead>
                                                                <tr>
                                                                    <th align="center" colspan="5">
                                                                        <table align="center"> <tr><td><h4>Información Pedido</h4></td></tr></table>

                                                                    </th>
                                                                </tr>
                                                                <tr>
                                                                    <th align="center" colspan="5">

                                                                        <table align="center"> <tr><td>Producto / Norma</td></tr></table>
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td align="center" colspan="5">

                                                                        @Model.ProductosLista[0].Descripcion - @Model.ProtocoloAplicable - @Model.ProductosLista[0].NormaProducto
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                            <thead>
                                                                <tr>

                                                                    <th>Descripción del ensayo / Servicio</th>
                                                                    <th>Producto / Cantidad</th>
                                                                    <th>Marca</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>

                                                                    <td colspan="1">
                                                                        @Model.CotizacionesLista[0].NombreCotizacion

                                                                    </td>
                                                                    <td> @Model.ProductosLista[0].NombreProducto / @Model.CotizacionesLista[0].CantidadProductos </td>
                                                                    <td>@Model.ProductosLista[0].MarcaProducto</td>
                                                                </tr>
                                                            </tbody>
                                                            <thead>
                                                                <tr>
                                                                    <th>Modelo</th>
                                                                    <th>Justificación de la familia</th>
                                                                    <th>Numero SEC</th>

                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td>@Model.ProductosLista[0].ModeloProducto</td>
                                                                    <td>@Model.ProductosLista[0].FamiliaProducto</td>
                                                                    <td>@Model.NumeroSec</td>

                                                                </tr>
                                                            </tbody>

                                                        </table>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    @if (Model.StatusPedidoEnsayo > 2 && Model.EnsayosLista != null && Model.EnsayosLista.Count > 0)
                                    {
                                        @if (Model.EnsayosLista[0].StatusEnsayo == "Aprobado")
                                        {
                                            <fieldset>  <legend>Aprobación Reportes</legend></fieldset>

                                            <table width="95%" align="center">
                                                <tr>
                                                    <td>
                                                        <div class="legend">
                                                            <span> @Model.AprobacionLista[0].TipoAprobacion</span>
                                                            @if (Model.AprobacionLista[0].EstadoAprobacion != "SI")
                                                            {
                                                                <div class="pull-right">


                                                                    <a class="link helper-font-14">   <i id="btnModificarAprobacion" class="fa fa-unlock fa-fw" data-toggle="modal" data-target="#ModificarAprobacionModal" data-id="@Model.IdPedidoEnsayo"></i></a>
                                                                </div>
                                                            }
                                                        </div>
                                                        <table class="table table-bordered table-condensed">
                                                            <tbody>
                                                                <tr>
                                                                    <th>Aprobado</th>
                                                                    <th>Usuario</th>
                                                                    <th>Fecha</th>
                                                                </tr>
                                                                <tr class="helper-font-small">
                                                                    <td>
                                                                        @Model.AprobacionLista[0].EstadoAprobacion;
                                                                    </td>
                                                                    <td>
                                                                        @Model.AprobacionLista[0].UsuarioDesignadoAprobacion;
                                                                    </td>
                                                                    <td>
                                                                        @Model.AprobacionLista[0].FechaCreacionAprobacion2;
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <th colspan="3">Comentarios</th>
                                                                </tr>
                                                                <tr class="helper-font-small">
                                                                    <td colspan="3"> @Model.AprobacionLista[0].ComentariosAprobacion;</td>
                                                                </tr>

                                                            </tbody>
                                                        </table>

                                                    </td>
                                                    <td width="10%"></td>
                                                    <td>

                                                        <div class="legend">
                                                            <span> @Model.AprobacionLista[1].TipoAprobacion</span>

                                                            @if (Model.AprobacionLista[0].EstadoAprobacion == "SI")
                                                            {

                                                                @if (Model.AprobacionLista[1].EstadoAprobacion != "SI")
                                                                {
                                                                    <div class="pull-right">

                                                                        <a class="link helper-font-14"><i id="btnModificarAprobacion1" class="fa fa-unlock fa-fw" data-toggle="modal" data-target="#ModificarAprobacionModal1" data-id="@Model.IdPedidoEnsayo"></i></a>

                                                                    </div>
                                                                }
                                                            }
                                                        </div>
                                                        <table class="table table-bordered table-condensed">
                                                            <tbody>
                                                                <tr>
                                                                    <th>Aprobado</th>
                                                                    <th>Usuario</th>
                                                                    <th>Fecha</th>
                                                                </tr>
                                                                <tr class="helper-font-small">
                                                                    <td>
                                                                        @Model.AprobacionLista[1].EstadoAprobacion;
                                                                    </td>
                                                                    <td>
                                                                        @Model.AprobacionLista[1].UsuarioDesignadoAprobacion;
                                                                    </td>
                                                                    <td>
                                                                        @Model.AprobacionLista[1].FechaCreacionAprobacion2;
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <th colspan="3">Comentarios</th>
                                                                </tr>
                                                                <tr class="helper-font-small">
                                                                    <td colspan="3"> @Model.AprobacionLista[1].ComentariosAprobacion;</td>
                                                                </tr>

                                                            </tbody>
                                                        </table>
                                                    </td>

                                                    <td width="10%"></td>
                                                    <td>

                                                        <div class="legend">
                                                            <span> @Model.AprobacionLista[2].TipoAprobacion</span>

                                                            @if (Model.AprobacionLista[1].EstadoAprobacion == "SI")
                                                            {

                                                                @if (Model.AprobacionLista[2].EstadoAprobacion != "SI")
                                                                {
                                                                    <div class="pull-right">
                                                                        <a class="link helper-font-14"><i id="btnModificarAprobacion2" class="fa fa-unlock fa-fw" data-toggle="modal" data-target="#ModificarAprobacionModal2" data-id="@Model.IdPedidoEnsayo"></i></a>
                                                                    </div>
                                                                }
                                                            }
                                                        </div>
                                                        <table class="table table-bordered table-condensed">
                                                            <tbody>
                                                                <tr>
                                                                    <th>Aprobado</th>
                                                                    <th>Usuario</th>
                                                                    <th>Fecha</th>
                                                                </tr>
                                                                <tr class="helper-font-small">
                                                                    <td>
                                                                        @Model.AprobacionLista[2].EstadoAprobacion;
                                                                    </td>
                                                                    <td>
                                                                        @Model.AprobacionLista[2].UsuarioDesignadoAprobacion;
                                                                    </td>
                                                                    <td>
                                                                        @Model.AprobacionLista[2].FechaCreacionAprobacion2;
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <th colspan="3">Comentarios</th>
                                                                </tr>
                                                                <tr class="helper-font-small">
                                                                    <td colspan="3"> @Model.AprobacionLista[2].ComentariosAprobacion;</td>
                                                                </tr>

                                                            </tbody>
                                                        </table>
                                                    </td>
                                                </tr>
                                            </table>
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



<div id="CrearNuevaMuestra" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Crear nueva muestra</h4>
            </div>
            <form asp-action="GuardarMuestra" class="form-horizontal" method="post">
                <div class="modal-body">

                    <div id="CrearNuevaMuestra-body">


                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" id="btnCrearMuestra" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <input type="submit" value="Guardar Muestra" class="btn btn-default" />
                </div>
            </form>
        </div>

    </div>
</div>

<div id="ModificarMuestraModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Editar Muestra</h4>
            </div>
            <form asp-action="GuardarModificacionMuestra" class="form-horizontal" method="post">
                <div class="modal-body">

                    <div id="ModificarMuestra-Body">


                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <input type="submit" value="Modificar" class="btn btn-default" />
                </div>
            </form>
        </div>

    </div>
</div>



@*Modal para modificar aprobacion*@
<div id="ModificarAprobacionModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Aprobación</h4>
            </div>
            <form asp-action="GuardarModficacionAprobacion" class="form-horizontal" method="post">
                <div class="modal-body">

                    <div id="ModificarAprobacion-Body">


                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <input type="submit" value="Aprobar" class="btn btn-default" />
                </div>
            </form>
        </div>

    </div>
</div>


<div id="ModificarAprobacionModal1" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Evaluación</h4>
            </div>
            <form asp-action="GuardarModficacionAprobacion" class="form-horizontal" method="post">
                <div class="modal-body">

                    <div id="ModificarAprobacion1-Body">


                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <input type="submit" value="Aprobar" class="btn btn-default" />
                </div>
            </form>
        </div>

    </div>
</div>

<div id="ModificarAprobacionModal2" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Revisión y Decisión</h4>
            </div>
            <form asp-action="GuardarModficacionAprobacion" class="form-horizontal" method="post">
                <div class="modal-body">

                    <div id="ModificarAprobacion2-Body">


                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <input type="submit" value="Aprobar" class="btn btn-default" />
                </div>
            </form>
        </div>

    </div>
</div>

@section Scripts {
    <script src="~/js/ScriptAprobacion.js"></script>
    <script src="~/js/EditarContactos.js"></script>
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
